<html>
    <head>
        <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
        <title>NgPost architecture and few dev details</title>
		<style>
.hiddenElement {
	display:none;
}
code {
    background-color: #f5f5f5;
    border-radius: 3px;
    padding: 2px 5px;
    font-size: 14px;
    font-family: monospace;
}
className {
    color: #8a2be2;
    font-weight: bold;
}
classMethod {
    color: #00008b;
    font-weight: bold;
}
classMember{
    color: #8b0000;
    font-weight: bold;
}
        .class-name {
            color: #8a2be2;
            font-weight: bold;
        }
        .class-method {
            color: #00008b;
            font-weight: bold;
        }
        .class-member {
            color: #8b0000;
            font-weight: bold;
        }
		</style>
		<script type="text/javascript">
function show_hide_topic(divName){
    var div = document.getElementById(divName);

    if (div.className.indexOf('hiddenElement') >= 0 ) {
        div.className=div.className.replace('hiddenElement', '');
    } else{
        div.className+=' hiddenElement';
    }
}

function show_hide_all(show){
	var divs = document.getElementsByTagName("div");
	for(var i = 0; i < divs.length; i++){
		if (show){
			if (divs[i].className.indexOf('hiddenElement') >= 0){
				divs[i].className=divs[i].className.replace('hiddenElement', '');
			}
		} else{
			if (divs[i].className.indexOf('hiddenElement') < 1){
				divs[i].className+=' hiddenElement';
			}
		}
	}
}
		</script>
    </head>
    <body onload="show_hide_all(true)">
<pre>
                   __________               __
       ____    ____\\______   \\____  _______/  |_
      /    \\  / ___\\|     ___/  _ \\/  ___/\\   __\\
     |   |  \\/ /_/  >    |  (  <_> )___ \\  |  |
     |___|  /\\___  /|____|   \\____/____  > |__|
          \\//_____/                    \\/
                          v 5.0
</pre>
<br />


<p>
NgPost started back in 2000 as a command line poster written in C++/Qt. <br/>
Its primary idea was to be fast, so it was written in C++ rather than interpreted languages. <br/>
Then, I made the assumption that encoding the articles could be time-consuming. <br/>
Using a pool of NNTP connections, the aim was thus to always have prepared articles ready for them, 
so they could post them straight away to Usenet (without no interuption, no computation).<br/>
NgPost is multi-thread and completely non blocking. (i.e: asynchronous with Qt event loop)<br />
NgPost is fully opensource, <a href="https://github.com/mbruel/ngPost">available here on github</a>.
</p>


<br />
<h3><a href="javascript:show_hide_topic('MAIN_ARCHI');">Main architecture</a></h3>
<div id="MAIN_ARCHI" class="hiddenElement">
some explanation of the diagram will arrive asap...
<br />
<img src="./archi_NgPost_Main.Architecture.svg" />
<br />
	<br />
	<hr />
	<br />
</div>


<h3><a href="javascript:show_hide_topic('NNTP_POSTING');">NntpConnections and PostingJobs</a></h3>
<div id="NNTP_POSTING" class="hiddenElement">
<p>
<className>PostingJob</className> are created and goes into the main thread event loop using mainly
<classMethod>NgPost::startPostingJob</classMethod><br />
They will go either in <classMember>NgPost::_activeJob</classMember> or in the queue <classMember>NgPost::_pendingJobs</classMember><br />
They are started (in main Thread, where they live) by emitting this signal:
  <classMethod>void sigStartPosting(bool isActiveJob);</classMethod> <br/>
Here are its <className>QueuedConnection</className> connections:
<pre>
<code>
    connect(this, &PostingJob::sigStartPosting,     this,     &PostingJob::onStartPosting);
    connect(this, &PostingJob::sigStopPosting,      this,     &PostingJob::onStopPosting);
    connect(this, &PostingJob::sigPostingStarted,   &_ngPost, &NgPost::onPostingJobStarted);
    connect(this, &PostingJob::sigPackingDone,      &_ngPost, &NgPost::onPackingDone);
    connect(this, &PostingJob::sigPostingFinished,  &_ngPost, &NgPost::onPostingJobFinished);
    connect(this, &PostingJob::sigNoMorePostingConnection, &_ngPost, &NgPost::onNoMorePostingConnection);
</code>
</pre>

It is holding mainly:
<ul>
    <li><className>PostingParamsPtr</className>::<classMember>_params</classMember>
         : all posting parameters including the list of files</li>
    <li><className>QFileInfoList</className>::<classMember>_files</classMember>
         : files that will be posted by <classMethod>_postFiles()</classMethod> <br />
          they can be directly <code>_params->files()</code> if no packing (compression and/or par2)<br />
          most likely they will be replaced by the created archives located in <classMember>_packingTmpDir</classMember>
    </li>
    <li><className>QVector&lt;NntpConnection *&gt;</className>::<classMember>_nntpConnections</classMember>
         : </li>
     <li><className>QQueue&lt;NNTP::File *&gt;</className>::<classMember>_filesToUpload</classMember>
         : </li>
    <li><className>QMutex</className>::<classMember>_secureDiskAccess</classMember>
         : </li>
    <li><className>QVector&lt;Poster *&gt;</className>::<classMember>_posters</classMember>
         : </li>
</ul>
<pre>
...


...
</pre>
  


</p>
<br />
<img src="./archi_NNTP_and_PostingJob.svg" />
<br />
	<br />
	<hr />
	<br />
</div>


    </body>
</html>
